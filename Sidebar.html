

<html>
 <head>
  <title>Simple TinCanJS Example</title>
  <script src="https://rawgit.com/RusticiSoftware/TinCanJS/master/build/tincan-min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="https://rawgit.com/adlnet/xAPIWrapper/master/dist/xapiwrapper.min.js"></script>
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">

  <script>
  var tincan = new TinCan (
  {
      recordStores: [
          {
              endpoint: "https://htk.tlu.ee//lrs/data/xAPI",
              username: "65d86065e4aa635e545b1d71dcc8894c35ab686a",
              password: "cffe0080f36cc30383c0c9f9a075cd5030e75838",
              allowFail: false
          }
      ]
  }
);
var formID;
console.log(formID);
window.onload = function(){
        var nimi='Tiit';
        console.log(formID);
        document.querySelector('#send-data').addEventListener('click',function(){
        console.log("Alustan saatmist");
        var t0=performance.now();
        tincan.sendStatement(
        {
  actor: {
      name: "LiveQuest TEST",
      account: { 
    homePage: "https://docs.google.com/forms",
    name: formID
  }
  },
  verb: {
    id: "http://adlnet.gov/expapi/verbs/completed",
    display: {"en-US": "completed"}
  },
  object: {
    id: "http://www.tlu.ee/~lauriv/activities/solo-hang-gliding",
      definition: {
        type: "http://adlnet.gov/expapi/activities/course",
        name: { "en-US": "Solo Hang Gliding" }
      }
  },
  context: {
    instructor: {
      name: "Irene Instructor",
      mbox: "mailto:irene@example.com"
    },
    contextActivities:{
      parent: { "id": "http://example.com/activities/hang-gliding-class-a" },
      grouping: { "id": "http://example.com/activities/hang-gliding-school" }
    }
  }
});
var t1=performance.now();
console.log("Saatmine kestis"+(t1 - t0) + " milliseconds.");

        
        });

    
}
      
     

  </script>
 </head>
 <body>
      <div class="sidebar">
      <form>
    
    
        <div class="block" id="button-bar">
          <button class="action" id="send-data">SEND</button>
        </div>
        <div class='block'>
        <input type='checkbox' id='data-sender'>
        <label for='data-sender'>Saada infot edasi Learning Lockerisse</label>
        </div>
         <div class="block" id="button-bar">
         <button class="action" id="save-settings">Save</button>
        </div>

      </form>
    </div>
    <script>
    
    $(function() {
        $('#save-settings').click(saveSettingsToServer);        
        google.script.run      
                         .withSuccessHandler(loadSettings)
                         .withFailureHandler(showStatus)
                         .withUserObject($('#button-bar').get())
                         .getSettings();
                         
                       
        google.script.run      
                         .withSuccessHandler(loadId)
                         .withFailureHandler(showStatus)
                         .sendId();
        
      });
    
    
    function saveSettingsToServer() {
        this.disabled = true;
        $('#status').remove();
        var dataNotify = $('#data-sender').is(':checked');
        var settings = {
          'dataNotify': dataNotify,
        };
        console.log(settings);
    
        // Save the settings on the server
        google.script.run
            .withSuccessHandler(
              function(msg, element) {
                showStatus('Saved settings', $('#button-bar'));
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showStatus(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .saveSettings(settings);
        // console.log(settings);
      } 
      
            /**
       * Callback function that populates the notification options using
       * previously saved values.
       *
       * @param {Object} settings The saved settings from the client.
       */
      function loadSettings(settings) {
       // console.log(settings);
        if (settings.dataNotify == 'true') {
          $('#data-sender').prop('checked', true);
        }
    }
    
    function loadId(id){
        console.log(id);
        formID=id;
        console.log(formID);
    }
            /**
       * Inserts a div that contains an status message after a given element.
       *
       * @param {String} msg The status message to display.
       * @param {Object} element The element after which to display the Status.
       */
      function showStatus(msg, element) {
         var div = $('<div>')
             .attr('id', 'status')
             .attr('class','error')
             .text(msg);
        $(element).after(div);
      }
    </script>
    
 </body>
</html>
